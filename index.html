<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktiver Finanzrechner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Midnight Slate -->
    <!-- Application Structure Plan: A single-page application built in one HTML file. The layout is designed for clarity and ease of use. A static header contains all user-input parameters. The main content area below is scrollable and contains a dynamic chart, a key metrics summary card, and two distinct, collapsible tables for the accumulation and decumulation phases. This structure was chosen to provide a clear hierarchy: high-level summary (chart, metrics), then granular detail (tables). The flow is intuitive: set your data, see the visual summary, then explore the year-by-year details on demand. -->
    <!-- Visualization & Content Choices: 1. User Inputs -> Goal: Data Entry -> Presentation: Grouped input fields -> Interaction: Real-time updates. Justification: Immediate feedback. Method: HTML forms, JS. 2. Key Metrics -> Goal: Summarize -> Presentation: Highlighted stat cards. Interaction: Dynamic updates. Justification: Quick access to most important outcomes. Method: HTML/JS. 3. Wealth Growth -> Goal: Compare nominal vs. real wealth -> Viz: Line Chart. Interaction: Hover tooltips. Justification: Ideal for trends. Library: Chart.js. 4. Detailed Projections -> Goal: Organize detailed data -> Presentation: Collapsible HTML tables. Interaction: Show/hide full data. Justification: Reduces clutter, improves focus. Method: JS DOM manipulation. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* gray-900 */
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .table-container::-webkit-scrollbar {
            height: 8px;
        }
        .table-container::-webkit-scrollbar-track {
            background: #374151; /* gray-700 */
        }
        .table-container::-webkit-scrollbar-thumb {
            background-color: #6b7280; /* gray-500 */
            border-radius: 10px;
            border: 2px solid #374151; /* gray-700 */
        }
        .toggle-checkbox:checked {
            right: 0;
            border-color: #0ea5e9;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #0ea5e9;
        }
        .table-row-hidden {
            display: none;
        }
    </style>
</head>
<body class="text-slate-300">

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <header class="py-10 text-center">
            <h1 class="text-4xl sm:text-5xl font-bold text-white tracking-tight">Finanzieller Vermögensrechner</h1>
            <p class="mt-4 text-lg text-slate-400">Prognostizieren Sie Ihre finanzielle Zukunft über den gesamten Lebenszyklus.</p>
        </header>

        <!-- Input Parameters -->
        <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 mb-8">
            <h2 class="text-xl font-semibold mb-5 flex items-center text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 text-sky-500"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>
                Ihre Parameter
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-8">
                <div>
                    <label for="currentAge" class="block text-sm font-medium text-slate-400">Aktuelles Alter</label>
                    <input type="number" id="currentAge" class="w-full mt-1 bg-gray-700 border-gray-600 text-white rounded-md p-2 focus:ring-sky-500 focus:border-sky-500" value="29">
                </div>
                <div>
                    <label for="retirementAge" class="block text-sm font-medium text-slate-400">Rentenalter</label>
                    <input type="number" id="retirementAge" class="w-full mt-1 bg-gray-700 border-gray-600 text-white rounded-md p-2 focus:ring-sky-500 focus:border-sky-500" value="69">
                </div>
                <div>
                    <label for="lifeExpectancy" class="block text-sm font-medium text-slate-400">Lebenserwartung</label>
                    <input type="number" id="lifeExpectancy" class="w-full mt-1 bg-gray-700 border-gray-600 text-white rounded-md p-2 focus:ring-sky-500 focus:border-sky-500" value="95">
                </div>
                 <div>
                    <label for="initialGrossSalary" class="block text-sm font-medium text-slate-400">Bruttogehalt/Jahr (heute)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="initialGrossSalary" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="40000">
                        <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">€</span>
                    </div>
                </div>
                 <div>
                    <label for="monthlyExpenses" class="block text-sm font-medium text-slate-400">Lebenskosten (mtl.) <span id="net-income-info" class="font-normal text-slate-500"></span></label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="monthlyExpenses" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="1500">
                        <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">€</span>
                    </div>
                </div>
                <div>
                    <label for="savingsRate" class="block text-sm font-medium text-slate-400">Sparrate (v. Rest)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="savingsRate" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="80">
                        <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">%</span>
                    </div>
                </div>
                <div>
                    <label for="initialAssets" class="block text-sm font-medium text-slate-400">Startvermögen</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="initialAssets" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="60000">
                        <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">€</span>
                    </div>
                </div>
                <div>
                    <label for="salaryGrowthRate" class="block text-sm font-medium text-slate-400">Gehaltswachstum</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="salaryGrowthRate" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="3">
                        <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">%</span>
                    </div>
                </div>
                 <div>
                    <label for="expensesGrowthRate" class="block text-sm font-medium text-slate-400">Kostensteigerung</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="expensesGrowthRate" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="2">
                        <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">%</span>
                    </div>
                </div>
                <div>
                    <label for="investmentReturnRate" class="block text-sm font-medium text-slate-400">Kapitalmarkt-Rendite</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="investmentReturnRate" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="6">
                        <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">%</span>
                    </div>
                </div>
                <div>
                    <label for="inflationRate" class="block text-sm font-medium text-slate-400">Inflationsrate</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="inflationRate" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="2">
                         <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">%</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <label for="inheritanceToggle" class="block text-sm font-medium text-slate-400">Erbschaft?</label>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="inheritanceToggle" id="inheritanceToggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="inheritanceToggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
            </div>
            <div id="inheritance-inputs" class="hidden mt-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <div>
                    <label for="inheritanceAmount" class="block text-sm font-medium text-slate-400">Erbsumme</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="inheritanceAmount" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="150000">
                         <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">€</span>
                    </div>
                </div>
                <div>
                    <label for="inheritanceYear" class="block text-sm font-medium text-slate-400">Jahr des Erbes</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="inheritanceYear" class="w-full bg-gray-700 border-gray-600 text-white rounded-md p-2 pr-10 focus:ring-sky-500 focus:border-sky-500" value="2045">
                    </div>
                </div>
            </div>
        </div>

        <main>
            <!-- Chart -->
            <div class="bg-gray-800 p-4 sm:p-6 rounded-2xl shadow-lg border border-gray-700 mb-8">
                <h2 class="text-xl font-semibold mb-4 text-white">Vermögensentwicklung über den Lebenszyklus</h2>
                <div class="chart-container">
                    <canvas id="wealthChart"></canvas>
                </div>
            </div>
            
            <!-- Key Metrics -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 mb-8">
                <h2 class="text-xl font-semibold mb-5 flex items-center text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 text-sky-500"><path d="M12 20V10M18 20V4M6 20V16"/></svg>
                    Wichtigste Kennzahlen
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                    <div>
                        <p class="text-sm text-slate-400">Renteneintrittsalter</p>
                        <p class="text-2xl font-bold text-white" id="metric-retirement-age">_</p>
                    </div>
                    <div>
                        <p class="text-sm text-slate-400">Vermögen bei Renteneintritt</p>
                        <p class="text-2xl font-bold text-white" id="metric-retirement-assets">_</p>
                    </div>
                    <div>
                        <p class="text-sm text-slate-400">Jährl. Rendite (Annahme)</p>
                        <p class="text-2xl font-bold text-white" id="metric-investment-return">_</p>
                    </div>
                </div>
            </div>

            <!-- Disclaimer -->
            <div class="bg-amber-900/20 border-l-4 border-amber-500 text-amber-300 p-4 rounded-r-lg mb-8" role="alert">
                <p class="font-bold">Wichtiger Hinweis</p>
                <p>Dies ist eine vereinfachte Modellrechnung. Annahmen: Renteneintritt zum gewählten Alter, Lebenskosten in der Rente entsprechen dem letzten Nettogehalt. Kapitalertragsteuer von 25% auf Zinserträge berücksichtigt.</p>
            </div>

            <!-- Accumulation Table -->
            <div class="bg-gray-800 rounded-2xl shadow-lg border border-gray-700 overflow-hidden mb-8">
                <div class="flex justify-between items-center p-6">
                    <h2 class="text-xl font-semibold text-white" id="accumulation-title">Ansparphase bis zur Rente</h2>
                    <button id="toggle-accumulation" class="text-sm text-sky-400 hover:text-sky-300">Alle anzeigen</button>
                </div>
                <div class="overflow-x-auto table-container">
                    <table class="w-full text-left">
                        <thead class="bg-gray-700/50">
                            <tr>
                                <th class="p-4 font-semibold text-slate-300">Jahr</th>
                                <th class="p-4 font-semibold text-slate-300">Alter</th>
                                <th class="p-4 font-semibold text-slate-300">Brutto (jährl.)</th>
                                <th class="p-4 font-semibold text-slate-300">Netto (monatl.)</th>
                                <th class="p-4 font-semibold text-slate-300">Kosten (monatl.)</th>
                                <th class="p-4 font-semibold text-slate-300">Übrig (monatl.)</th>
                                <th class="p-4 font-semibold text-slate-300">Sparbetrag (monatl.)</th>
                                <th class="p-4 font-semibold text-slate-300">Vermögen (Ende)</th>
                            </tr>
                        </thead>
                        <tbody id="accumulation-table-body" class="divide-y divide-gray-700">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Retirement Table -->
            <div class="bg-gray-800 rounded-2xl shadow-lg border border-gray-700 overflow-hidden mb-8">
                <div class="flex justify-between items-center p-6">
                    <h2 class="text-xl font-semibold text-white" id="retirement-title">Entnahmephase in der Rente</h2>
                    <button id="toggle-retirement" class="text-sm text-sky-400 hover:text-sky-300">Alle anzeigen</button>
                </div>
                <div class="overflow-x-auto table-container">
                    <table class="w-full text-left">
                        <thead class="bg-gray-700/50">
                            <tr>
                                <th class="p-4 font-semibold text-slate-300">Jahr</th>
                                <th class="p-4 font-semibold text-slate-300">Alter</th>
                                <th class="p-4 font-semibold text-slate-300">Lebenskosten (jährl.)</th>
                                <th class="p-4 font-semibold text-slate-300">Zinserträge (n. Steuer)</th>
                                <th class="p-4 font-semibold text-slate-300">Vermögen (Ende)</th>
                            </tr>
                        </thead>
                        <tbody id="retirement-table-body" class="divide-y divide-gray-700">
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <footer class="text-center py-10 text-slate-500 text-sm">
            <p>Erstellt mit HTML, Tailwind CSS und Chart.js. Berechnungen sind Schätzungen.</p>
        </footer>
    </div>

    <script>
        const inputs = {
            currentAge: document.getElementById('currentAge'),
            retirementAge: document.getElementById('retirementAge'),
            lifeExpectancy: document.getElementById('lifeExpectancy'),
            initialGrossSalary: document.getElementById('initialGrossSalary'),
            salaryGrowthRate: document.getElementById('salaryGrowthRate'),
            monthlyExpenses: document.getElementById('monthlyExpenses'),
            expensesGrowthRate: document.getElementById('expensesGrowthRate'),
            savingsRate: document.getElementById('savingsRate'),
            initialAssets: document.getElementById('initialAssets'),
            investmentReturnRate: document.getElementById('investmentReturnRate'),
            inflationRate: document.getElementById('inflationRate'),
            inheritanceToggle: document.getElementById('inheritanceToggle'),
            inheritanceAmount: document.getElementById('inheritanceAmount'),
            inheritanceYear: document.getElementById('inheritanceYear'),
        };

        const accumulationTableBody = document.getElementById('accumulation-table-body');
        const retirementTableBody = document.getElementById('retirement-table-body');
        const chartCtx = document.getElementById('wealthChart').getContext('2d');
        const inheritanceInputsDiv = document.getElementById('inheritance-inputs');
        const netIncomeInfoSpan = document.getElementById('net-income-info');
        let wealthChart;
        
        let showAllAccumulation = false;
        let showAllRetirement = false;
        
        const toggleAccumulationBtn = document.getElementById('toggle-accumulation');
        const toggleRetirementBtn = document.getElementById('toggle-retirement');

        const formatCurrency = (num) => new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(num);

        function calculateNetSalary(grossSalary) {
            const healthInsuranceCeiling = 62100;
            const pensionInsuranceCeiling = 90600;
            const healthInsuranceRate = 0.073 + 0.0085;
            const nursingCareInsuranceRate = 0.023;
            const pensionInsuranceRate = 0.093;
            const unemploymentInsuranceRate = 0.013;
            
            const healthContribution = Math.min(grossSalary, healthInsuranceCeiling) * healthInsuranceRate;
            const nursingCareContribution = Math.min(grossSalary, healthInsuranceCeiling) * nursingCareInsuranceRate;
            const pensionContribution = Math.min(grossSalary, pensionInsuranceCeiling) * pensionInsuranceRate;
            const unemploymentContribution = Math.min(grossSalary, pensionInsuranceCeiling) * unemploymentInsuranceRate;
            const socialContributions = healthContribution + nursingCareContribution + pensionContribution + unemploymentContribution;

            const taxableIncome = grossSalary - socialContributions - 1264;
            const basicTaxFreeAllowance = 11604;
            let incomeTax = 0;

            if (taxableIncome > basicTaxFreeAllowance) {
                const y = (taxableIncome - basicTaxFreeAllowance) / 10000;
                if (taxableIncome <= 17005) { incomeTax = (979.18 * y + 1400) * y; } 
                else if (taxableIncome <= 66760) { const z = (taxableIncome - 17005) / 10000; incomeTax = (192.59 * z + 2397) * z + 975.79; } 
                else if (taxableIncome <= 277825) { incomeTax = 0.42 * taxableIncome - 10253.81; } 
                else { incomeTax = 0.45 * taxableIncome - 18588.56; }
            }
            
            const soliThreshold = 18130;
            let soli = 0;
            if (incomeTax > soliThreshold) {
               soli = Math.min(0.055 * incomeTax, 0.119 * (incomeTax - soliThreshold));
               if (incomeTax > 34332) { soli = 0.055 * incomeTax; }
            }
            const totalTax = incomeTax + soli;
            return { netSalary: grossSalary - socialContributions - totalTax };
        }
        
        function updateNetIncomeInfo() {
            const gross = Number(inputs.initialGrossSalary.value);
            if (gross <= 0) {
                netIncomeInfoSpan.textContent = '';
                return;
            }
            const { netSalary } = calculateNetSalary(gross);
            const monthlyNet = netSalary / 12;
            netIncomeInfoSpan.textContent = `(Netto mtl: ${formatCurrency(monthlyNet)})`;
        }

        function runProjection() {
            const currentAge = Number(inputs.currentAge.value);
            const retirementAge = Number(inputs.retirementAge.value);
            const lifeExpectancy = Number(inputs.lifeExpectancy.value);

            if (currentAge >= lifeExpectancy || currentAge >= retirementAge) {
                accumulationTableBody.innerHTML = '';
                retirementTableBody.innerHTML = '';
                if(wealthChart) wealthChart.destroy();
                return;
            }

            let currentAssets = Number(inputs.initialAssets.value);
            let currentGrossSalary = Number(inputs.initialGrossSalary.value);
            let currentAnnualExpenses = Number(inputs.monthlyExpenses.value) * 12;
            const capitalGainsTaxRate = 0.25;
            
            const projectionDuration = lifeExpectancy - currentAge;
            const retirementStartYear = new Date().getFullYear() + (retirementAge - currentAge);
            let lastAnnualNetSalary = 0;
            let assetsAtRetirement = 0;
            
            const fullData = [];
            for (let i = 0; i <= projectionDuration; i++) {
                const year = new Date().getFullYear() + i;
                const age = currentAge + i;
                
                let grossSalary = 0, netSalary = 0, annualSavings = 0, monthlyNetSalary = 0, monthlyDisposableIncome = 0, monthlySavingsAmount = 0, investmentGains = 0;
                let retirementWithdrawal = 0, netInvestmentGains = 0;

                investmentGains = currentAssets * (Number(inputs.investmentReturnRate.value) / 100);
                netInvestmentGains = investmentGains * (1 - capitalGainsTaxRate);

                if (year < retirementStartYear) {
                    if (i > 0) {
                        currentGrossSalary *= 1 + (Number(inputs.salaryGrowthRate.value) / 100);
                        currentAnnualExpenses *= 1 + (Number(inputs.expensesGrowthRate.value) / 100);
                    }
                    
                    const result = calculateNetSalary(currentGrossSalary);
                    grossSalary = currentGrossSalary;
                    netSalary = result.netSalary;
                    lastAnnualNetSalary = netSalary;

                    const annualDisposableIncome = netSalary - currentAnnualExpenses;
                    annualSavings = annualDisposableIncome > 0 ? annualDisposableIncome * (Number(inputs.savingsRate.value) / 100) : 0;
                    
                    monthlyNetSalary = netSalary / 12;
                    const monthlyExpensesValue = currentAnnualExpenses / 12;
                    monthlyDisposableIncome = monthlyNetSalary - monthlyExpensesValue;
                    monthlySavingsAmount = monthlyDisposableIncome > 0 ? monthlyDisposableIncome * (Number(inputs.savingsRate.value) / 100) : 0;

                    currentAssets += netInvestmentGains + annualSavings;
                } else {
                    if (assetsAtRetirement === 0) {
                        assetsAtRetirement = currentAssets;
                    }
                    retirementWithdrawal = lastAnnualNetSalary;
                    currentAssets += netInvestmentGains - retirementWithdrawal;
                }

                if (inputs.inheritanceToggle.checked && year === Number(inputs.inheritanceYear.value)) {
                    currentAssets += Number(inputs.inheritanceAmount.value);
                }
                
                if (currentAssets < 0) currentAssets = 0;

                const inflationFactor = Math.pow(1 + (Number(inputs.inflationRate.value) / 100), i);
                const realTotalAssets = currentAssets / inflationFactor;

                fullData.push({
                    year, age,
                    grossSalary: Math.round(grossSalary),
                    netSalary: Math.round(netSalary),
                    monthlyNetSalary: Math.round(monthlyNetSalary),
                    monthlyExpenses: Math.round(currentAnnualExpenses / 12),
                    monthlyDisposableIncome: Math.round(monthlyDisposableIncome),
                    monthlySavingsAmount: Math.round(monthlySavingsAmount),
                    totalAssets: Math.round(currentAssets),
                    realTotalAssets: Math.round(realTotalAssets),
                    retirementWithdrawal: Math.round(retirementWithdrawal),
                    netInvestmentGains: Math.round(netInvestmentGains),
                });
            }
            
            document.getElementById('metric-retirement-age').textContent = retirementAge;
            document.getElementById('metric-retirement-assets').textContent = formatCurrency(assetsAtRetirement);
            document.getElementById('metric-investment-return').textContent = `${inputs.investmentReturnRate.value}%`;

            document.getElementById('accumulation-title').textContent = `Ansparphase bis ${retirementAge}`;
            document.getElementById('retirement-title').textContent = `Entnahmephase (ab ${retirementAge} bis ${lifeExpectancy})`;
            renderTables(fullData, retirementStartYear);
            renderChart(fullData);
            updateNetIncomeInfo();
        }

        function renderTables(data, retirementStartYear) {
            accumulationTableBody.innerHTML = '';
            retirementTableBody.innerHTML = '';
            
            const accumulationData = data.filter(d => d.year < retirementStartYear);
            const retirementData = data.filter(d => d.year >= retirementStartYear && d.totalAssets > 0);

            accumulationData.forEach((d, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700/50 transition-colors';
                if (inputs.inheritanceToggle.checked && d.year === Number(inputs.inheritanceYear.value)) {
                    row.className += ' bg-sky-900/50 hover:bg-sky-800/50';
                }
                if (!showAllAccumulation && index >= 10) {
                    row.classList.add('table-row-hidden');
                }
                row.innerHTML = `
                    <td class="p-4 whitespace-nowrap text-slate-400">${d.year}</td>
                    <td class="p-4 whitespace-nowrap text-slate-300">${d.age}</td>
                    <td class="p-4 whitespace-nowrap text-slate-300">${formatCurrency(d.grossSalary)}</td>
                    <td class="p-4 whitespace-nowrap font-semibold text-white">${formatCurrency(d.monthlyNetSalary)}</td>
                    <td class="p-4 whitespace-nowrap text-red-400">${formatCurrency(d.monthlyExpenses)}</td>
                    <td class="p-4 whitespace-nowrap text-slate-300">${formatCurrency(d.monthlyDisposableIncome)}</td>
                    <td class="p-4 whitespace-nowrap text-green-400">${formatCurrency(d.monthlySavingsAmount)}</td>
                    <td class="p-4 whitespace-nowrap font-bold text-white">${formatCurrency(d.totalAssets)}</td>
                `;
                accumulationTableBody.appendChild(row);
            });
            
            retirementData.forEach((d, index) => {
                 const row = document.createElement('tr');
                 row.className = 'hover:bg-gray-700/50 transition-colors';
                 if (!showAllRetirement && index >= 10) {
                    row.classList.add('table-row-hidden');
                 }
                 row.innerHTML = `
                    <td class="p-4 whitespace-nowrap text-slate-400">${d.year}</td>
                    <td class="p-4 whitespace-nowrap text-slate-300">${d.age}</td>
                    <td class="p-4 whitespace-nowrap text-red-400">${formatCurrency(d.retirementWithdrawal)}</td>
                    <td class="p-4 whitespace-nowrap text-green-400">${formatCurrency(d.netInvestmentGains)}</td>
                    <td class="p-4 whitespace-nowrap font-bold text-white">${formatCurrency(d.totalAssets)}</td>
                `;
                retirementTableBody.appendChild(row);
            });
            
            toggleAccumulationBtn.textContent = showAllAccumulation ? 'Weniger anzeigen' : `Alle ${accumulationData.length} anzeigen`;
            toggleAccumulationBtn.style.display = accumulationData.length > 10 ? 'block' : 'none';

            toggleRetirementBtn.textContent = showAllRetirement ? 'Weniger anzeigen' : `Alle ${retirementData.length} anzeigen`;
            toggleRetirementBtn.style.display = retirementData.length > 10 ? 'block' : 'none';
        }
        
        function renderChart(data) {
            if (wealthChart) {
                wealthChart.destroy();
            }
            wealthChart = new Chart(chartCtx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.year),
                    datasets: [
                        {
                            label: 'Vermögen (nominal)',
                            data: data.map(d => d.totalAssets),
                            borderColor: '#0ea5e9',
                            backgroundColor: 'rgba(14, 165, 233, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                        },
                        {
                            label: 'Vermögen (kaufkraftbereinigt)',
                            data: data.map(d => d.realTotalAssets),
                            borderColor: '#f59e0b',
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            borderWidth: 3,
                        },
                        {
                            label: 'Nettogehalt (jährl.)',
                            data: data.map(d => d.netSalary),
                            borderColor: '#a855f7',
                            backgroundColor: 'transparent',
                            fill: false,
                            borderWidth: 2,
                            hidden: true,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { ticks: { color: '#94a3b8', callback: (v) => new Intl.NumberFormat('de-DE', {notation: 'compact'}).format(v)}, grid: { color: '#334155' }},
                        x: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' }}
                    },
                    plugins: {
                        legend: { labels: { color: '#d1d5db' }},
                        tooltip: {
                            backgroundColor: '#1f2937', titleColor: '#f9fafb', bodyColor: '#d1d5db',
                            borderColor: '#374151', borderWidth: 1,
                            callbacks: {
                                label: (c) => `${c.dataset.label || ''}: ${formatCurrency(c.parsed.y)}`
                            }
                        }
                    }
                }
            });
        }

        toggleAccumulationBtn.addEventListener('click', () => {
            showAllAccumulation = !showAllAccumulation;
            runProjection();
        });
        
        toggleRetirementBtn.addEventListener('click', () => {
            showAllRetirement = !showAllRetirement;
            runProjection();
        });

        inputs.inheritanceToggle.addEventListener('change', () => {
            inheritanceInputsDiv.classList.toggle('hidden');
            if (!inputs.inheritanceToggle.checked) {
                inputs.inheritanceAmount.value = 0;
            }
            runProjection();
        });

        Object.values(inputs).forEach(input => {
            if(input.id !== 'inheritanceToggle') {
                input.addEventListener('input', runProjection);
            }
        });
        
        inputs.initialGrossSalary.addEventListener('input', updateNetIncomeInfo);
        document.addEventListener('DOMContentLoaded', runProjection);
    </script>

</body>
</html>
